%
\clearpage
\subsection{Variable Dependency Soundness}
% \begin{thm}[$\vardep$ Soudness]
% \label{thm:algvardep_sound}
% Given a program ${c}$, 
% \[
% \begin{array}{l}
%   \forall {x}_1^{l_1}, {x}_2^{l_2} \in \lvar_{{c}}.
%   \vardep({x}_1^{l_1}, {x}_2^{l_2}, {c})
%   \\ \quad \implies \exists \event_1, \event_2 \in \eventset^{\asn}, \trace, \trace'  \in \mathcal{T}, D \in \dbdom , c \in \cdom \st
%   \\ \qquad
%  \trace = \event_1 \tracecat \trace' \cdot \event_2
%    \implies 
%   (\pi_{1}{(\event_1)}, \pi_{2}{(\event_1)}) = ({x}_1, l_1)
% \implies
% (\pi_{1}{(\event_2)}, \pi_{2}{(\event_2)}) = ({x}_2, l_2)
% \implies
%   \mathcal{A}(\event_1, \event_2, \trace, c, D) \neq \emptyset
% \end{array}
% \]
% \end{thm}
% \begin{proof}
% Proved by unfolding the $\vardep$ and apply Theorem.~\ref{thm:algeventdep_sound}.
% \end{proof}
%
\begin{thm}[$\vardep$ implies $\flowsto$]
\label{thm:flowstovardep_sound}
Given a program ${c}$, for all  $ x^i, y^j \in \lvar_{{c}}$, if $\vardep(x^i, y^j, {c})$,
then
%  either $\flowsto(x^i, y^j, c)$ 
% or 
there exist $z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}}$ with $n \geq 0$ such that   
$\flowsto(x^i,  z_1^{r_1}, c) 
\land \cdots \land \flowsto(z_n^{r_n}, y^j, c)$
%
\[
\begin{array}{l}
  \forall x^i, y^j \in \lvar_{{c}}.
  \vardep(x^i, y^j, {c})
  \\ \quad \implies
  \Big( \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
  \flowsto(x^i,  z_1^{r_1}, c) 
  \land \cdots \land \flowsto(z_n^{r_n}, y^j, c) \Big)
\end{array}
\]
\end{thm}
\begin{proof}
  It is sufficient to show:
  \\
  1. $x^i$ is directly used in the expression of the assignment command associated to $y^j$, or a boolean
  expression of the guard for a $\eif$ or $\ewhile$ command with the assignment command associated to $y^j$ shows up in the body of that command, 
  we call it, $x^i$ directly flows to $y^j$,
  i.e.,
  $ \flowsto(x^i, y^j, {c})$;
  \\
  2. otherwise, there exists another labelled variable $z^l$ with \emph{variable May-Dependency} relation on $x^i$ and 
  $z^l$ directly flows to $y^j$, i.e., 
  \\
  $\Big(
    \exists z^l \in \lvar_{{c}}.
  \vardep(x^i, z^l, {c})   
  \implies
   \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
  \flowsto(x^i,  z_1^{r_1}, c) 
  \land \cdots \land \flowsto(z_n^{r_n}, z^l, c) 
  \land  \flowsto(z^l, y^j, {c})
  \Big)$.
%
\\ Formally as follows:
\[
  \begin{array}{l}
    \flowsto(x^i, y^j, {c})
    \\
    \lor 
    \Big(
      \exists z^l \in \lvar_{{c}}.
    \vardep(x^i, z^l, {c})   
  \implies
     \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
    \flowsto(x^i,  z_1^{r_1}, c) 
    \\ \qquad \qquad 
    \land \cdots  \land \flowsto(z_n^{r_n}, z^l, c) 
    \land  \flowsto(z^l, y^j, {c})
    \Big)
  \end{array}
  \]
\\
%
Without induction hypothesis, the existence of $z^l$, and the conclusion that there is a "flows to" chain from $x^i$ to $z^l$ in case 2 is not proved in previous soundness proof.
\\
%
So, I adopt the way of induction on trace.
By restricting the domain of $z^l$ on the variables "showing up" in the 
trace between evaluating $x^i$ and $y^j$, I show the existence of this $z^l$ and get the conclusion from induction hypothesis. 
\\
    By definition of $\vardep(x^i, y^j, {c})$, 
let $D \in \dbdom$ be the dataset,
and $\trace \in \mathcal{T}$, $\event_x, \event_y$ be the trace and two events satisfying the definition, 
with $\pi_1(\event_x) = x$ and $\pi_1(\event_y) = y$,
% then it is sufficient to show:
%     \[
%       \begin{array}{l}
%       \Big(
%          \exists \trace \in \mathcal{T} \st 
%         \eventdep^{val}(\event_x, \event_y, \trace, c, D) \lor 
%         (\exists \event_b \in \eventset^{\test} \st 
%         \eventdep^{val}(\event_x, \event_b, \trace, c, D)
%         \land \eventdep^{\ctl}(\event_b, \event_y, c, D))  
%         \Big)
%         \\ \quad \implies
%   \Big( \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
%   \flowsto(x^i,  z_1^{r_1}, c) 
%   \land \cdots \land \flowsto(z_n^{r_n}, y^j, c) \Big)
%       \end{array}
%     \]
%     \[
%         (\exists \event_b \in \eventset^{\test} \st x^i \in VAR(\pi_1(\event_b)) 
%         \land \eventdep^{\ctl}(\event_b, \event_y, c, D))    
%     \implies
%   \Big( \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
%   \flowsto(x^i,  z_1^{r_1}, c) 
%   \land \cdots \land \flowsto(z_n^{r_n}, y^j, c) \Big)
% \]
% Proved by applying Theorem.~\ref{thm:algvardep_sound} and Correctness of $\mathcal{A}$ in Theorem.~\ref{thm:alg_correct}.
% \[
% 	\begin{array}{l}
% 		\forall D \in \dbdom , c \in \cdom, \trace \in \mathcal{T} \st \forall \event_1, \event_2 \in \eventset^{\asn} \st
% 		 \exists \trace' \in \mathcal{T} \st \trace = [\event_1] \tracecat \trace' \tracecat [\event_2]
% 		\implies
% 		\eventdep(\event_1, \event_2, \trace, c, D) 
% 		\\ \quad 
% 		\implies 
% 		\flowsto(\pi_1(\event_1)^{\pi_2(\event_1)}, \pi_1(\event_2)^{\pi_2(\event_2)}, c) 
% 		\\ \qquad \quad \lor
% 		\exists \event \in \trace' \st 
% 		\left( 		
% 			\eventdep(\event_1, \event, \trace[\event_1:\event], c, D)
% 		\land 
% 		\flowsto(\pi_1(\event)^{\pi_2(\event)}, \pi_1(\event_2)^{\pi_2(\event_2)}, c) 
% 	\right) 
% 		% \\ \qquad \qquad \lor
% 		% \flowsto(\pi_1(\event_1)^{\pi_2(\event_1)}, \pi_1(\event_2)^{\pi_2(\event_2)}, c) 
% 	\end{array}
% 	\]
then by Lemma~\ref{lem:dep_inv} and \ref{lem:indepevents_inv_gnl}, it is sufficient to show:
$$
\begin{array}{l}
(x^i \in VAR(\expr_y)\lor 
(\exists \event_b \in \eventset^{\test} \st x^i \in VAR(\pi_1(\event_b)) 
\land \eventdep^{\ctl}(\event_b, \event_y, c, D)))
\\ \quad 
\lor 
(\exists \event_z \in \trace' \st 
    \eventdep^{val}(\event_x, \event_z, \trace_z, c, D)
    \\ \qquad 
    \implies 
    \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
\flowsto(x^i,  z_1^{r_1}, c) 
\land \cdots \land \flowsto(z_n^{r_n},  \pi_1(\event_z)^{\pi_2(\event_z)}, c)
    )
    \\ \quad
    \land 
( \pi_1(\event_z)^{\pi_2(\event_z)} \in VAR(\expr_y)) 
\lor  \exists \event_b \in \eventset^{\test} \st\pi_1(\event_z) \in VAR(\pi_1(\event_b)) 
\land \eventdep^{\ctl}(\event_b, \event_y, c, D))
\end{array}
$$
%
% \caseL{Case 1: ($\eventdep^{val}(\event_x, \event_y, \trace, c, D)) $)} 
% Let $[\assign{y}{\expr_y}]^j$ be the assignment command associated to $y^j$ in $c$,
% it is sufficient to show following statement:
%     $$
%     \begin{array}{l}
%     x^i \in VAR(\expr_y)
%     \\ \quad 
%     \lor 
%     (\exists \event_z \in \eventset^{val}, \trace_z \in \mathcal{T} \st 
%         \eventdep^{val}(\event_x, \event_z, \trace_z, c, D)
%         \\ \qquad 
%         \implies 
%         \exists n \in \mathbb{N}, z_1^{r_1}, \cdots, z_n^{r_n} \in \lvar_{{c}} \st n \geq 0 \land
%   \flowsto(x^i,  z_1^{r_1}, c) 
%   \land \cdots \land \flowsto(z_n^{r_n},  \pi_1(\event_z)^{\pi_2(\event_z)}, c)
%         )
%         \\ \quad
%         \land 
%    ( \pi_1(\event_z)^{\pi_2(\event_z)} \in VAR(\expr_y)) 
%     \lor  \exists \event_b \in \eventset^{\test} \st x^i \in VAR(\pi_1(\event_b)) 
%     \land \eventdep^{\ctl}(\event_b, \event_y, c, D))
%     \end{array}
%     $$
% Otherwise, it can only be the case 2.
% \caseL{Case 2: 
%     ($\eventdep^{val}(\event_x, \event_y, \trace, c, D)) $)}

%     $$
%     x^i \in VAR(\expr_y)
%     \lor 
%     (\exists \event_b \in \eventset^{\test} \st x^i \in VAR(\pi_1(\event_b)) 
%     \land \eventdep^{\ctl}(\event_b, \event_y, c, D))
%     $$

\end{proof}

\subsection{$\THESYSTEM$ Soundness}
{
  \begin{thm}[Soundness of the \THESYSTEM].
  Given a program $\ssa{c}$, we have:
  %
  \[
  \progA(\ssa{c}) \geq A(\ssa{c}).
  \]
  \end{thm}
}

